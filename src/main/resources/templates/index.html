<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Player Companion</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.4.0/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<style>
    .notification {
        position: fixed;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        background-color: rgba(63, 55, 55, 0.726);
        /* Slightly transparent */
        color: #fff;
        padding: 10px;
        border-radius: 5px;
        font-size: 16px;
        display: none;
        /* Initially hidden */
        z-index: 1000;
        /* Ensure it appears on top */
    }

    /* Hide scrollbars but still allow scrolling */
    .hidden-scrollbar {
        scrollbar-width: none;
        /* For Firefox */
        -ms-overflow-style: none;
        /* For Internet Explorer and Edge */
    }

    .hidden-scrollbar::-webkit-scrollbar {
        display: none;
        /* For Chrome, Safari, and Opera */
    }

    .glow {
        box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        /* Gold glow */
        transition: box-shadow 0.3s ease-in-out;
    }

    /* The overlay that covers the whole screen */
    .overlay {
        display: none;
        /* Hidden by default */
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0);
        /* Semi-transparent background */
        justify-content: center;
        align-items: center;
        z-index: 10 00;
    }

    /* The smaller spinner */
    .spinner {
        width: 30px;
        height: 30px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid #3498db;
        border-radius: 50%;
        animation: spin 2s linear infinite;
    }

    .light-separator {
        border-color: rgba(229, 231, 235, 0.5);
        /* Lighter gray with 50% opacity */
    }

    #spinnerOverlay {
        display: none;
        /* Hidden by default */
        align-items: center;
        justify-content: center;
        background-color: rgba(255, 255, 255, 0);
        /* Optional: semi-transparent background */
    }


    /* Spinner animation */
    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }

    #handResultContainer {
        display: flex;
        overflow-x: auto;
        /* Enable horizontal scrolling */
        white-space: nowrap;
        /* Prevent circles from wrapping */
        scrollbar-width: none;
        /* Firefox: Hide scrollbar */

    }

    #handResultContainer div {
        flex-shrink: 0;
        /* Prevent the circles from shrinking */
    }

    #handResultContainer div {
        flex-shrink: 0;
        /* Prevent the circles from shrinking */
        margin: 1px;
        /* Added 1px margin around each circle */
    }

    #gameForm {
        position: relative;
        /* Necessary for the absolute positioning of the pseudo-element */
        z-index: 1;
        /* Ensure content is above the background */
    }

    #gameForm::before {
        content: "";
        background-image: url('/img/box_grid.jpg');
        background-repeat: repeat;
        /* Makes the background image repeat */
        background-size: 24px;
        /* Size of the background image */
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0.1;
        /* Adjust opacity here (0.0 to 1.0) */
        z-index: -1;
        /* Ensures it is behind the content */
    }


    /* ---------------------------------------------------- */

    .toggle-container {
        display: flex;
        align-items: center;
    }

    .toggle-label {
        margin-right: 10px;
        color: #4a5568;
        /* Gray text color */
    }

    .toggle-switch {
        position: relative;
        display: inline-block;
        width: 40px;
        /* Reduced width */
        height: 20px;
        /* Reduced height */
    }

    .toggle-input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        /* Track color */
        transition: .4s;
        border-radius: 20px;
        /* Rounded track */
    }

    .toggle-slider:before {
        position: absolute;
        content: "";
        height: 16px;
        /* Reduced knob height */
        width: 16px;
        /* Reduced knob width */
        left: 2px;
        /* Adjusted knob position */
        bottom: 2px;
        /* Adjusted knob position */
        background-color: white;
        /* Knob color */
        transition: .4s;
        border-radius: 50%;
    }

    .toggle-input:checked+.toggle-slider {
        background-color: #4a90e2;
        /* Track color when checked */
    }

    .toggle-input:checked+.toggle-slider:before {
        transform: translateX(20px);
        /* Knob position when checked */
    }

    /* ------------------PRGRESS BAR-------------------------------- */
    .progress-container {
        width: 100%;
        background-color: #e0e0df;
        border-radius: 25px;
        padding: 1px;
    }

    .progress-bar {
        height: 2px;
        /* Smaller height */
        width: 0;
        background-color: green;
        border-radius: 25px;
        transition: width 0.5s ease;
    }

    /* Color based on percentage */
    .low {
        background-color: red;
    }

    .medium {
        background-color: orange;
    }

    .high {
        background-color: green;
    }

    /* .online-user {
        position: relative;
        display: inline-block;
        padding: 5px;
      
    } */

    .icon {
        font-size: 20px;
        /* Smaller icon size */
        color: #28a745;
        /* Green color to indicate online status */
    }

    .online-user {
        margin-top: 10px;
        /* position: absolute; */
        top: 0;
        right: 0;
        /* background-color: #0dbb35; */
        color: #6b7280;
        border-radius: 50%;
        padding: 2px 5px;
        font-size: 11px;
        font-weight: normal;
        transform: translate(50%, -50%);
    }
</style>

<body class="bg-gray-100">
    <div class="container mx-auto p-2 relative">

        <div class="flex flex-col md:flex-row">
            <div class="w-full md:w-2/5 bg-white shadow-md rounded-lg mb-4" style="margin: 0.25%;padding: 0.5rem;">

                <!-- Header with icons -->
                <div class="bg-gradient-to-r from-blue-200 to-gray-200 rounded-t-lg shadow-md">
                    <div class="flex justify-between items-center">


                        <div class="flex items-center">
                            <span id="activeUsersCount" class="online-user">0</span>
                            <i class="fas fa-users text-green-500"></i>
                        </div>

                        <div class="flex-grow"></div>
                        <span class="text-sm font-semibold text-gray-500" id="strategyLabel"></span>
                        <div class="flex-grow"></div>

                        <div class="flex space-x-4 pl-2 ml-auto" style="margin-right: 10px;">

                            <button id="resetButton" class="cursor-pointer" aria-label="Change reset Status">
                                <img id="resetButtonImage" src="/img/circular_reset.png" class="w-6 h-6"
                                    alt="Reset Status">
                            </button>

                            <button id="pauseButton" class="cursor-pointer" aria-label="Pause">
                                <img id="pauseButtonImage" src="/img/play.png" class="w-6 h-6" alt="Pause">
                            </button>

                            <button id="playButton" class="cursor-pointer" aria-label="Pause">
                                <img id="playButtonImage" src="/img/pause.png" class="w-6 h-6" alt="Pause">
                            </button>

                        </div>


                        <!-- Three dots button with menu -->
                        <div class="relative">
                            <button id="threeDotsButton" class="cursor-pointer">
                                <i class="fas fa-ellipsis-v w-6 h-6 text-gray-500"></i>
                            </button>

                            <!-- Dropdown menu positioned below the button -->
                            <div id="dropdownMenu"
                                class="hidden absolute top-full right-0 mt-1 w-28 bg-white border border-gray-200 rounded-lg shadow-lg z-10">
                                <ul class="text-sm">
                                    <li class="px-4 py-2 hover:bg-gray-100 cursor-pointer">
                                        <!-- Integrated logout form inside the menu -->
                                        <form th:action="@{/logout}" method="post">
                                            <input type="hidden" th:name="${_csrf.parameterName}"
                                                th:value="${_csrf.token}" />
                                            <button type="submit" class="flex items-center space-x-1">
                                                <img src="/img/logout.png" class="w-5 h-5" alt="logout">
                                                <span>Logout</span>
                                            </button>
                                        </form>
                                    </li>
                                </ul>
                            </div>
                        </div>

                    </div>
                </div>



                <div id="inputsContainer" style="margin-top: 5px;">
                    <form id="gameForm">
                        <div style="height: 145px;">
                            <div id="circleContainer" class="gap-2 mb-2 w-full overflow-x-auto hidden-scrollbar"
                                style="max-height: 145px; white-space: nowrap;">
                                <div id="handResultColumn" class="flex flex-row wrap h-full w-full"></div>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Win and Lose -->
                <div class="gap-2 mb-2 w-full overflow-x-auto hidden-scrollbar"
                    style="white-space: nowrap; margin-top: 5px !important;">
                    <div id="handResultContainer" class="flex flex-row  wrap h-full w-full"></div>
                </div>

                <div class="progress-container">
                    <div id="progressBar" class="progress-bar"></div>
                </div>


                <div id="results" class="bg-white mt-4 rounded-md shadow-sm" style="margin-top: 2px !important;">
                    <div id="bettingResults" class="text-gray-700"></div>
                    <div id="finalStats" class="mt-2 font-bold text-gray-900"></div>
                </div>



                <div class="flex justify-between mb-2 hidden">
                    <button type="button" id="smallButton"
                        class="flex-1 bg-gradient-to-l from-blue-700 to-blue-800 text-white py-3 rounded hover:from-blue-600 hover:to-blue-700 transition duration-300 shadow-lg mr-2">
                        SMALL
                    </button>


                    <button type="button" id="bigButton"
                        class="flex-1 bg-gradient-to-r from-red-700 to-red-800 text-white py-3 rounded hover:from-red-600 hover:to-red-700 transition duration-300 shadow-lg ml-2">
                        BIG
                    </button>

                    <button type="button" id="trippleButton"
                    class="flex-1 bg-gradient-to-r from-green-700 to-green-800 text-white py-3 rounded hover:from-green-600 hover:to-green-700 transition duration-300 shadow-lg ml-2">
                    TRIPPLE
                </button>


                </div>

                <div class="flex  mb-2 hidden">
                    <button type="button" id="skipButton" onclick="turnOnOffSkip()"
                        class="flex-1 bg-gradient-to-l text-white py-1 rounded transition duration-200 mr-2">
                        Skip
                    </button>
                </div>



                <div id="status" class="text-sm text-center">
                </div>

                <div class="mt-4">
                    <div class="bg-blue-100 border border-blue-300 rounded-lg p-2 mb-2">
                        <h3 id="infoHeader" class="font-semibold text-xs"></h3>
                        <p id="infoContent" class="text-gray-700 text-xs"></p>
                    </div>
                </div>
            </div>


            <!-- Second Panel -->
            <div class="w-full md:w-3/5 bg-white shadow-md rounded-lg p-2 mb-2" style="margin: 0.25%;">

                <!-- Tab Navigation -->
                <div class="flex mb-2">
                    <button id="journalTab" class="flex-1 py-2 text-gray-700 text-xs border-b-2 border-blue-500"
                        onclick="showTab('History')">Gamre Result</button>
                    <button id="graphTab" class="flex-1 py-2 text-gray-500 border-b-2 text-xs"
                        onclick="showTab('graph')">Profit/Loss</button>
                    <button id="challengeTab" class="flex-1 py-2 text-gray-500 border-b-2 text-xs"
                        onclick="showTab('challenge')">Game Parameters</button>
                </div>

                <!-- Journal Tab Content -->
                <div id="journalSection">
                    <!-- profit and report selection section -->
                    <div class="bg-gray-100 border rounded-lg p-2 mb-1 flex items-center justify-between"
                        id="profitAndReportSection">
                        <!-- Reduced padding to p-2 -->
                        <div>
                            <h3 class="font-semibold text-xs"> <!-- Reduced font size to text-xs -->
                                Total Profit (u): <span id="totalProfit">0.00</span> <!-- Default value -->
                            </h3>
                            <p class="text-gray-700 text-xs">Date/Time: <span id="dateTime">2024-10-18 10:00</span></p>
                            <!-- Default value -->
                        </div>

                        <div class="flex space-x-2">
                            <!-- Back Icon -->
                            <button onclick="getJournal('back')" class="p-1 rounded hover:bg-gray-200">
                                <!-- Reduced padding to p-1 -->
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-600" fill="none"
                                    viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 19l-7-7 7-7" />
                                </svg>
                            </button>
                            <!-- Forward Icon -->
                            <button onclick="getJournal('forward')" class="p-1 rounded hover:bg-gray-200">
                                <!-- Reduced padding to p-1 -->
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-600" fill="none"
                                    viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 5l7 7-7 7" />
                                </svg>
                            </button>
                        </div>
                    </div>


                    <div id="journalContainer" class="grid grid-cols-1 md:grid-cols-2 gap-1">
                        <!-- Journal entries will be populated here -->
                        <!-- <div class="grid grid-cols-1 md:grid-cols-2 gap-1" id="journalEntriesContainer"></div> -->
                    </div>
                </div>


                <!-- Graph Tab Content -->
                <div class="hidden" id="graphContainer">
                    <div class="flex items-center mb-4">
                        <label class="mr-2 text-gray-700 text-sm" style="margin-right: 10px;">View By:</label>
                        <input type="radio" id="dayRadio" name="viewBy" value="day" class="mr-1 cursor-pointer" checked
                            onchange="handleViewChange()">
                        <label for="dayRadio" class="mr-4 text-gray-700 cursor-pointer text-sm">Day</label>
                        <input type="radio" id="weekRadio" name="viewBy" value="week" class="mr-1 cursor-pointer"
                            onchange="handleViewChange()">
                        <label for="weekRadio" class="text-gray-700 cursor-pointer text-sm">Week</label>
                    </div>
                    <canvas id="profitsGraph" width="400" height="200"></canvas>
                </div>


                <div id="challengeContainer" class="grid grid-cols-2 md:grid-cols-2 gap-2 text-sm hidden ">

                    <!-- Sensitivity -->
                    <label id="SensitivityValue" for="Sensitivity" class="text-sm text-left">Prediction
                        Sensitivity</label>
                    <input type="range" id="Sensitivity" class="p-1 border rounded text-sm" min="0" max="100" step="1"
                        value="50">


                    <!-- Stop Loss -->
                    <label for="stopLoss" class="text-sm text-left">Stop Loss</label>
                    <input type="number" id="stopLoss" class="p-1 border rounded text-sm" placeholder="Enter stop loss">

                    <!-- Stop Profit -->
                    <label for="stopProfit" class="text-sm text-left">Stop Profit</label>
                    <input type="number" id="stopProfit" class="p-1 border rounded text-sm"
                        placeholder="Enter stop profit">

                    <!-- Trailing Stop Spread -->
                    <label for="trailingStopSpread" class="text-sm text-left">Trailing Stop</label>
                    <div class="grid grid-cols-2 gap-2 mt-2" style="margin-left: 0px; margin-top: -5px;">
                        <div class="flex flex-col">
                            <label for="trailingStopActivation" class="text-xs">Trigger:</label>
                            <input type="number" id="trailingStopActivation" class="p-1 border rounded text-sm w-full"
                                placeholder="Trigger">
                        </div>
                        <div class="flex flex-col">
                            <label for="trailingStopSpread" class="text-xs">Spread:</label>
                            <input type="number" id="trailingStopSpread" class="p-1 border rounded text-sm w-full"
                                placeholder="Spread">
                        </div>
                    </div>


                    <!-- Money Management -->
                    <label for="moneyManagement" class="text-sm text-left">Money Management</label>
                    <select id="moneyManagement" class="p-1 border rounded text-sm">
                        <option value="FLAT">FLAT</option>
                        <option value="RLIZA">rLIZA</option>
                        <!-- <option value="KISS_MODIFIED">KISS MODIFIED</option> -->
                    </select>


                    <!-- Shield Section aligned under Money Management -->
                    <label class="text-sm text-left">Shield</label>
                    <div class="grid grid-cols-2 gap-2 mt-2" style="margin-left: 0px; margin-top: -5px;">
                        <div class="flex flex-col">
                            <label for="stopTrigger" class="text-xs">Trigger:</label>
                            <input type="number" id="stopTrigger" class="p-1 border rounded text-sm w-full"
                                placeholder="Trigger">
                        </div>
                        <div class="flex flex-col">
                            <label for="virtualWin" class="text-xs">Win:</label>
                            <input type="number" id="virtualWin" class="p-1 border rounded text-sm w-full"
                                placeholder="Win">
                        </div>
                    </div>





                    <div class="col-start-2 col-span-1 mt-2 hidden">
                        <!-- Shield Checkbox -->
                        <div class="flex items-center">
                            <input type="checkbox" id="isCompounding" class="mr-2">
                            <label for="isCompounding" class="text-sm text-left">Compounding</label>
                        </div>
                    </div>

                    <!-- Starting Fund -->
                    <label for="startingFund" class="text-sm text-left">Initial Fund</label>
                    <input type="number" id="startingFund" class="p-1 border rounded text-sm"
                        placeholder="Starting fund">


                    <label class="text-sm text-left">Daily Goal</label>
                    <div class="grid grid-cols-2 gap-2 mt-2" style="margin-left: 0px; margin-top: -5px;">
                        <div class="flex flex-col">
                            <label for="dailyGoalPercentage" class="text-xs">%</label>
                            <input type="number" id="dailyGoalPercentage" class="p-1 border rounded text-sm w-full"
                                placeholder="Percentage">
                        </div>
                        <div class="flex flex-col">
                            <label for="dailyGoalValue" class="text-xs">Amount</label>
                            <input type="number" id="dailyGoalValue" class="p-1 border rounded text-sm w-full bg-gray-200"
                                placeholder="Amount" readonly>
                        </div>
                    </div>



                    <!-- Current Fund -->
                    <label for="currentFund" class="text-sm hidden text-left">Current Fund</label>
                    <input type="number" id="currentFund" class="p-1 border rounded text-sm hidden"
                        placeholder="Current fund">


                    <!-- Bet Amount -->

                    <label for="betAmount" class="text-sm text-left">Bet Amount</label>
                    <input type="number" id="betAmount" class="p-1 border rounded text-sm bg-gray-200"
                        placeholder="Bet amount" readonly>




                    <!-- Save Parameters Button -->
                    <div class="col-span-2 flex flex-col justify-center mt-2">
                        <div id="successMessage" class="hidden text-green-500 text-sm mb-2 text-center"></div>
                        <!-- Success message -->
                        <button class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 max-w-xs mx-auto">Save
                            Parameters</button>
                    </div>

                </div>







            </div>
        </div>




        <div class="overlay" id="spinnerOverlay">
            <div class="spinner"></div>
        </div>

        <!-- Yes or No Dialog Modal -->
        <div id="yesNoModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden z-50">
            <div class="bg-white rounded-lg shadow-lg w-96">
                <!-- Modal Header -->
                <div class="px-4 py-2 border-b">
                    <h3 class="text-sm font-semibold">Confirmation</h3>
                </div>
                <!-- Modal Body -->
                <div class="p-4">
                    <p>Do you want to save this game result?</p>
                </div>
                <!-- Modal Footer -->
                <div class="px-4 py-2 border-t flex flex-col space-y-2">
                    <button id="yesButton"
                        class="text-xs bg-green-700 text-white w-full py-2 rounded-lg shadow hover:bg-green-600 transition duration-300 transform hover:scale-105">
                        Yes
                    </button>
                    <button id="noButton"
                        class="text-xs bg-blue-700 text-white w-full py-2 rounded-lg shadow hover:bg-blue-600 transition duration-300 transform hover:scale-105">
                        No
                    </button>
                    <button id="cancelButton" style="margin-top: 20px;"
                        class="text-xs bg-gray-500 text-white w-full py-2 rounded-lg shadow hover:bg-gray-600 transition duration-300 transform hover:scale-105">
                        Close
                    </button>
                </div>
            </div>
        </div>


        <!-- Strategies dialog-->

        <div class="notification" id="notification">
            <span id="message"></span>
        </div>


        <script>

            let playedShoe = 0;
            let dateCreated;
            var freezeState = 'N';
            var totalProfit = 0;
            var stompClient = null;

            var sensitivityGlobal = 50;





            // Create an Audio object with the MP3 file
            // const alertSound = new Audio('sounds/reverby-notification-sound-246407.mp3');


            // Create an Audio object for the notification sound
            const notificationSound = new Audio('sounds/reverby-notification-sound-246407.mp3');

            // Attempt to play the sound immediately
            notificationSound.play().catch(error => {
                console.log('Autoplay blocked. Waiting for user interaction.');

                // Add an event listener to play sound once on first user interaction
                document.addEventListener('click', playNotificationSound, { once: true });
                document.addEventListener('mousemove', playNotificationSound, { once: true });
            });

            // Function to play sound and remove listeners after it's triggered
            function playNotificationSound() {
                notificationSound.play();
                document.removeEventListener('click', playNotificationSound);
                document.removeEventListener('mousemove', playNotificationSound);
            }




            const ctx = document.getElementById('profitsGraph').getContext('2d');
            let dummyGraph; // Variable to hold the chart instance




            function toggleMenu() {

                const menu = document.getElementById('dropdownMenu');
                menu.classList.toggle('hidden');
            }


            function showNotification(message) {
                const notification = document.getElementById('notification');
                notification.style.display = 'block';

                $('#message').text(message);
                // Hide the notification after 1 second
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 4000);
            }


            function connect() {
                try {
                    var socket = new SockJS('/ws');
                    stompClient = Stomp.over(socket);
                    stompClient.connect({}, function (frame) {
                        console.log('Connected: ' + frame);
                        stompClient.subscribe('/topic/messages', function (message) {
                            // showMessage(message.body);
                            var messgae = message.body;

                            // console.log(message);

                            if (messgae.includes('SicBo:')) {


                                const pauseButton = document.getElementById('pauseButton');
                                const playButton = document.getElementById('playButton');

                                // Check if pauseButton is hidden
                                const isPauseButtonHidden = window.getComputedStyle(pauseButton).display === 'none' ||
                                    window.getComputedStyle(pauseButton).visibility === 'hidden';



                                // Check if playButton is hidden
                                const isPlayButtonHidden = window.getComputedStyle(playButton).display === 'none' ||
                                    window.getComputedStyle(playButton).visibility === 'hidden';






                                // var pauseAndPlayValue = localStorage.getItem('pauseAndPlay'); // Corrected key

                                if (!isPlayButtonHidden) {

                                    const dice = messgae.split(":");
                                    var dice_size = dice[1];
                                    var diceSum = dice[2];
                                    localStorage.removeItem('diceSum');
                                    localStorage.setItem('diceSum', diceSum);
                                    showSpinner();
                                    playGame(dice_size + ":" + diceSum);
                                }





                            } else {
                                setTimeout(() => {
                                    showNotification(message.body);
                                }, 1000);
                            }


                        });
                    }, function (error) {
                        console.error('Error: ' + error);
                    });
                } catch (e) {
                    console.log(e);
                }

            }


            function showSpinner() {
                const circleContainer = document.getElementById("circleContainer");
                const spinnerOverlay = document.getElementById("spinnerOverlay");

                // Get the position and dimensions of circleContainer
                const rect = circleContainer.getBoundingClientRect();

                // Show the spinner overlay
                spinnerOverlay.style.display = "flex";
                spinnerOverlay.style.position = "fixed"; // Change to fixed for screen-wide overlay
                spinnerOverlay.style.top = "0"; // Cover the whole screen
                spinnerOverlay.style.left = "0"; // Cover the whole screen
                spinnerOverlay.style.width = "100vw"; // Full viewport width
                spinnerOverlay.style.height = "100vh"; // Full viewport height
                spinnerOverlay.style.zIndex = "9999"; // Ensure it is above everything, including modals
            }


            function hideSpinner() {
                // Hide the overlay and spinner
                document.getElementById("spinnerOverlay").style.display = "none";
            }


            $(document).ready(function () {


                getPauseAndPlay();
                getFreezeStateAsync();

                (async () => {

                    await getJournal('today');
                    await currentState();

                })();

                // Get modal and buttons
                const modal = document.getElementById('yesNoModal');
                const openModalButton = document.getElementById('openModalButton');
                const yesButton = document.getElementById('yesButton');
                const noButton = document.getElementById('noButton');
                const cancelButton = document.getElementById('cancelButton');

                const pauseButton = document.getElementById('pauseButton');
                const playButton = document.getElementById('playButton');


                pauseButton.addEventListener('click', () => {
                    setPauseAndPlay('pause');

                });

                playButton.addEventListener('click', () => {
                    setPauseAndPlay('play');

                });


                // Close modal and handle Yes/No actions
                cancelButton.addEventListener('click', () => {
                    modal.classList.add('hidden');

                });



                // Close modal and handle Yes/No actions
                noButton.addEventListener('click', () => {
                    processEventToReset("no");
                });


                yesButton.addEventListener('click', async () => {
                    processEventToReset("yes");
                });


                // Event listener for PLAYER button
                $('#smallButton').on('click', function () {
                    showSpinner();
                    playGame("s:4");

                });

                // Event listener for BANKER button
                $('#bigButton').on('click', function () {
                    showSpinner();
                    playGame("b:11");
                });
                
                $('#trippleButton').on('click', function () {
                    showSpinner();
                    playGame("t:15");
                });
                


                // Toggle menu visibility when clicking the button
                document.getElementById('threeDotsButton').addEventListener('click', function (event) {
                    event.stopPropagation(); // Prevent click from propagating to document listener
                    toggleMenu();
                });

                // Close menu when clicking outside
                document.addEventListener('click', function (event) {
                    const menu = document.getElementById('dropdownMenu');
                    const button = document.getElementById('threeDotsButton');

                    // Check if the menu is open and the click is outside the menu and button
                    if (!menu.classList.contains('hidden') && !menu.contains(event.target) && event.target !== button) {
                        menu.classList.add('hidden');
                    }
                });







                // Event listener for RESET GAME button
                $('#resetButton').on('click', async function () {

                    let message = $('#status').text();
                    if (message.includes("Archived")) {
                        return;
                    }
                    modal.classList.remove('hidden');

                });



                getFreezeStateAsync();

                connect();


                postGameParameters();


                const slider = document.getElementById('Sensitivity');
                const output = document.getElementById('SensitivityValue');

                // Update the displayed value whenever the slider changes
                slider.oninput = function () {
                    output.textContent = "Prediction Sensitivity(" + this.value + ")";
                }

            });


            function postGameParameters() {
                $('.bg-blue-500').click(function (event) {
                    event.preventDefault(); // Prevent the default form submission

                    const slider = document.getElementById('Sensitivity');


                    // Collect input values from the form
                    const data = {
                        stopLoss: $('#stopLoss').val(),
                        stopProfit: $('#stopProfit').val(),
                        trailingStopSpread: $('#trailingStopSpread').val(),
                        trailingStopActivation: $('#trailingStopActivation').val(),
                        moneyManagement: $('#moneyManagement').val(),
                        isShield: $('#isShield').is(':checked') ? 1 : 0, // Convert checkbox to integer
                        sensitivity: slider.value,
                        isCompounding: $('#isCompounding').is(':checked') ? 1 : 0, // Convert checkbox to integer
                        stopTrigger: $('#stopTrigger').val(),
                        virtualWin: $('#virtualWin').val(),
                        startingFund: $('#startingFund').val(),
                        dailyGoalPercentage: $('#dailyGoalPercentage').val(),
                        betAmount: $('#betAmount').val()
                    };

                    // Send AJAX POST request
                    $.ajax({
                        url: '/api/game/parameters', // Change to your API endpoint
                        type: 'POST',
                        contentType: 'application/json', // Specify content type
                        data: JSON.stringify(data), // Convert data to JSON
                        success: function (response) {
                            // alert('Parameters saved successfully!');
                            // Optionally, you can clear the input fields or perform other actions here
                            fetchGameParameters();

                            // Show success message
                            $('#successMessage').text("Game parameters saved successfully!").removeClass('hidden');

                            // Hide the success message after 2 seconds
                            setTimeout(() => {
                                $('#successMessage').addClass('hidden'); // Add hidden class to hide the message
                            }, 2000);


                        },
                        error: function (xhr, status, error) {
                            alert('An error occurred: ' + xhr.responseText);
                        }
                    });
                });
            }

            async function fetchGameParameters() {
                try {
                    const response = await fetch('/api/game/parameters', {
                        method: 'GET', // HTTP method
                        headers: {
                            'Content-Type': 'application/json', // Set the content type to JSON
                        },
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }

                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }

                    const data = await response.json(); // Parse the JSON response

                    // Populate input fields with retrieved data
                    $('#stopLoss').val(data.stopLoss);
                    $('#stopProfit').val(data.stopProfit);
                    $('#trailingStopSpread').val(data.trailingStopSpread);
                    $('#trailingStopActivation').val(data.trailingStopActivation);
                    $('#moneyManagement').val(data.moneyManagement);
                    $('#isShield').prop('checked', data.isShield === 1);
                    $('#isCompounding').prop('checked', data.isCompounding === 1);
                    $('#stopTrigger').val(data.stopTrigger);
                    $('#virtualWin').val(data.virtualWin);
                    $('#startingFund').val(data.startingFund);
                    $('#currentFund').val(data.currentFund);
                    $('#dailyGoalPercentage').val(data.dailyGoalPercentage);
                    $('#betAmount').val(data.betAmount);
                    $('#Sensitivity').val(data.sensitivity);
                    $('#dailyGoalValue').val(Math.round((data.dailyGoalPercentage / 100) * data.startingFund / 10) * 10);


                    $("#strategyLabel").text(toCamelCase(data.moneyManagement.replace("_", " ")));

                    const SensitivityValue = document.getElementById('SensitivityValue');
                    SensitivityValue.textContent = "Prediction Sensitivity(" + data.sensitivity + ")";

                    sensitivityGlobal  = data.sensitivity;


                } catch (error) {
                    console.error("Error fetching game parameters:", error);
                    // alert("Failed to fetch game parameters. Please try again.");
                }
            }


            async function processEventToReset(answer) {





                const modal = document.getElementById('yesNoModal');
                showSpinner();
                try {
                    const response = await $.post('/api/sicBo/reset', { yesNo: answer });
                    displayResultToUi(response);
                } catch (error) {
                    $('#resetButton').prop('disabled', false);
                    $('#status').text(`Error: ${error.responseText || 'Unexpected error'}`);
                } finally {
                    hideSpinner();
                    $('#undoButton').hide();
                    modal.classList.add('hidden');
                }

            }


            async function playGame(userInput) {

                try {
                    const response = await $.post('/api/sicBo/play', $.param({
                        userInput,
                        recommendedBet: $('#recommendedBet').text(),
                        suggestedUnit: $('#suggestedBetUnit').text()
                    }));

                    displayResultToUi(response);
                } catch (xhr) {

                    $('#status').text(`Error: ${xhr.responseText || 'Unexpected error'}`);
                }
            }


            async function displayResultToUi(response) {
                // console.log(response);

                hideSpinner();


                const { handCount, wins, losses, profit } = response.gameStatus;
                const statusMessage = response.message;
                // const tempMessage = (statusMessage.includes('Wait') && statusMessage.includes('Wait for virtual win')) ? "" : statusMessage;

                // Handle status, reset, and undo button visibility
                $('#status').toggle(handCount > 0 || statusMessage.includes("Daily limit!"));

                $('#status')
                    .text(statusMessage)
                    .css({
                        'color': statusMessage.includes("profit") ? 'green' : statusMessage.includes("loss") ? 'red' : 'black',
                        'display': 'none' // Add this line to hide the element
                    });

                if (statusMessage.includes("reset") || statusMessage.includes("Initialized")) {
                    $("#handResultColumn").empty();
                    $('#status').text("");
                    await getJournal("today");
                }

                $("#baseBetUnit").val(response.baseBetUnit);

                $("#initialPlayingUnit").val(response.initialPlayingUnits);

                // Display betting results
                $('#bettingResults').html(`
                <div class="bg-white shadow-md rounded-lg overflow-hidden">



                <div class="bg-gray-200 text-gray-800 text-xs font-semibold p-1 flex justify-between">
                    <span id="playedShoe">Round: ${playedShoe}</span>

                   
                    
                    <span id="handCount" >Rolls: ${handCount}</span>
                </div>



                <div class="p-2 space-y-1">
                    <div class="flex justify-between border-b pb-1">
                    <span class="font-bold text-xs">Wins/Losses:</span><span class="text-xs">${wins}/${losses}</span>
                    </div>
                  
                    <div class="flex justify-between border-b pb-1" style="${!response.trailingStop ? 'display:none;' : ''}">
                    <span class="font-bold text-xs">Trailing Stop:</span><span class="text-xs">${parseInt(response.trailingStop) || 0}</span>
                    </div>

                    <div class="flex justify-between border-b pb-1">
                    <span class="font-bold text-xs">Net Profit:</span>
                    <span class="text-xs ${profit >= 0 ? 'text-green-600' : 'text-red-600'}">${profit.toFixed(0)}</span>
                    </div>
                    <div class="flex justify-between border-b pb-1">
                    <span class="font-bold text-xs">Stake:</span><span id="nextbetText" class="text-sm font-bold">${response.suggestedBetUnit.toFixed(0)}</span>
                    </div>
                    <div class="flex justify-between">
                    <span class="font-bold text-xs">Next Bet:</span>
                    
                    
                    <span style="width: 45px;" class="${statusMessage === 'Wait for virtual win.' ? 'text-sm'
                        : response.recommendedBet.includes('Wait') ? 'text-sm'
                            : response.recommendedBet == 'Small' ? 'h-5 bg-blue-500 text-sm text-white flex items-center justify-center rounded shadow-lg'
                                : response.recommendedBet == 'Big' ? 'h-5 bg-red-500 text-sm text-white flex items-center justify-center rounded shadow-lg' :
                                    'w-20 h-5 bg-green-500 text-sm text-white flex items-center justify-center rounded shadow-lg'}">
                        ${statusMessage === 'Wait for virtual win.' ? 'Wait..'
                        : statusMessage.includes('Wait') ? 'Wait..'
                            : response.recommendedBet}
                    </span>
                    </div>
                


                </div>
                </div>
                <p id="recommendedBet" style="display:none;">${response.recommendedBet}</p>
                <p id="suggestedBetUnit" style="display:none;">${response.suggestedBetUnit.toFixed(0)}</p>`);



                if (statusMessage.includes("Restart") || statusMessage.includes("Daily limit")) {


                    $('#infoHeader').text("Game Over");
                    $('#infoContent').text(statusMessage);

                    // this is to make automated
                    setPauseAndPlay('pause');
                    processEventToReset("yes");



                } else {

                    // Update header and content based on total profit
                    const headerText = totalProfit > 10 ? "Lucky Day" : "Reminder";
                    const contentText = totalProfit > 10
                        ? "You're now in profit! Time to call it a day and enjoy your success."
                        : "Follow the app's guidelines to protect your bankroll.";

                    // Update the UI elements for the header and content
                    $('#infoHeader').text(headerText);
                    $('#infoContent').text(contentText);

                    // Get values from input fields
                    const dailyGoalValue = parseFloat($('#dailyGoalValue').val()) || 0;
                    const betAmountValue = parseFloat($('#betAmount').val()) || 1; // Default to 1 to prevent division by zero

                    // Calculate the unit goal
                    const unitGoal = dailyGoalValue / betAmountValue;

                    // Check if the total profit has reached or exceeded the daily goal
                    if (totalProfit >= unitGoal) {
                        $('#infoHeader').text('Daily Goal');
                        $('#infoContent').text('Congrats! You successfully hit your daily goal.');
                        setPauseAndPlay('play');
                    }

                }


                try {

                    displayResults(response.sequence.toUpperCase(), response.diceNumber);


                } catch (e) {

                }





                getHandResult(response);
                getActiveUsers();
                // Handle button visibility after game result
                if (statusMessage.includes("reached")) {

                    await getJournal("today");
                }



                showorHideStrategiesDots();

                updateProgressBar(response.confidence);
                getFreezeStateAsync();

                // var unitValue = parseFloat($('#nextbetText').text());
                // console.log(unitValue);


                var betUnitValue = getNumbersFromString($("#nextbetText").text());

                if (betUnitValue > 0) {

                    betAmountValue = $('#betAmount').val();

                    playNotificationSound();


                }


                // // Get the content of the element with ID 'handCount'
                // const handCountText = $('#handCount').text();
                // const msgHeader  = $('#infoHeader').text();

                // if (getNumbersFromString(handCountText) >= 70 && !msgHeader.includes("Archive")) {
                //     processEventToReset('yes');
                //     setPauseAndPlay('pause');
                // }



            }


            function addContainer(group) {
                const container = document.createElement('div');
                container.classList.add('flex', 'flex-col', 'items-start', 'justify-start', 'h-full');



                // Create circles for each character in the group
                group.split('').forEach((char, index) => {

                    const circle = document.createElement('div');
                    circle.classList.add('flex', 'items-center', 'justify-center', 'w-6', 'h-6', 'border', 'rounded-full',
                        char === 'S' ? 'bg-blue-500' : char === 'B' ? 'bg-red-500' : 'bg-green-500');

                    // Create a smaller white circle inside
                    const innerCircle = document.createElement('div');
                    innerCircle.classList.add('flex', 'items-center', 'justify-center', 'w-4', 'h-4', 'bg-white', 'rounded-full', 'text-xs', 'text-gray-400');
                    innerCircle.textContent = '' // Set dice sum for each character

                    // Add the inner circle to the outer circle
                    circle.appendChild(innerCircle);
                    container.appendChild(circle);
                });

                return container;
            }

            function displayResults(playerAndBankerCollections, diceSumCollection) {
                const results = playerAndBankerCollections.replace("1111", "").split('');
                const diceSums = diceSumCollection.replace("1111", "").split(',');

                // console.log("diceSums"+diceSums);

                // Clear previous results
                document.getElementById('handResultColumn').innerHTML = '';
                document.getElementById('handResultContainer').innerHTML = '';

                let currentChar = results[0];


                let group = currentChar;

                const column = document.getElementById('handResultColumn');
                const circleContainer = document.getElementById('circleContainer');

                for (let i = 1; i < results.length; i++) {
                    if (results[i] === currentChar) {
                        group += results[i];

                    } else {
                        column.appendChild(addContainer(group));
                        currentChar = results[i];

                        group = currentChar;
                    }
                }


                // Append the last group after the loop
                column.appendChild(addContainer(group));


                // Auto-scroll the circleContainer to the right after adding new content
                setTimeout(() => {
                    circleContainer.scrollLeft = circleContainer.scrollWidth;
                }, 0);



                const innerElements = column.getElementsByClassName('bg-white');

                for (let i = 0; i < innerElements.length + 1; i++) {
                    innerElements[i].textContent = diceSums[i + 1];

                }





            }
            function getPauseAndPlay() {

                const pauseButton = document.getElementById('pauseButton');
                const playButton = document.getElementById('playButton');

                pauseButton.classList.add('hidden');
                playButton.classList.add('hidden');

                var pauseAndPlayValue = localStorage.getItem('pauseAndPlay'); // Corrected key

                if (pauseAndPlayValue === 'play') {
                    pauseButton.classList.remove('hidden');
                } else {
                    playButton.classList.remove('hidden');
                }

                showorHideStrategiesDots();
            }


            function setPauseAndPlay(pauseAndPlayValue) {

                localStorage.setItem('pauseAndPlay', pauseAndPlayValue);
                getPauseAndPlay();
            }



            // async function getStrategy() {


            //     try {
            //         const response = await $.ajax({
            //             url: '/api/sicBo/strategy',
            //             type: 'GET'
            //         });


            //         $("#strategyLabel").text(toCamelCase(response) === 'One_three_two_six' ? 'Stochastic' : toCamelCase(response));


            //         getFreezeStateAsync();


            //     } catch (error) {
            //         console.log('Error:', error);
            //         alert('Operation failed: ' + error.responseText);
            //     }
            // }



            // function turnOnOffSkip() {
            //     const button = document.getElementById("skipButton");

            //     if (freezeState === 'Y') {
            //         freezeStat = 'N';
            //         setShieldValue('OFF');
            //     } else {

            //         setShieldValue('ON');

            //     }
            // }



            // Function to modify the date
            function modifyDate(dateString, days, options) {
                const dateObj = new Date(dateString);
                dateObj.setUTCDate(dateObj.getUTCDate() + days);
                return dateObj.toLocaleDateString('en-CA', options);  // Return the new date in YYYY-MM-DD format
            }

            async function getJournal(purpose) {


                const currentDate = new Date();
                const options = { timeZone: 'UTC', year: 'numeric', month: '2-digit', day: '2-digit' };
                const utcDate = currentDate.toLocaleDateString('en-CA', options); // Format: YYYY-MM-DD

                // Set dateCreated initially if not already set
                dateCreated = dateCreated || utcDate;

                // Modify dateCreated based on purpose
                dateCreated = purpose === 'back'
                    ? modifyDate(dateCreated, -1, options)
                    : purpose === 'forward'
                        ? modifyDate(dateCreated, 1, options)
                        : utcDate;

                try {
                    const response = await $.ajax({
                        url: '/api/journals/dateCreated',
                        type: 'GET',
                        data: { dateCreated }
                    });




                    $('#journalContainer').empty();

                    $('#dateTime').text(dateCreated);




                    totalProfit = 0;

                    const validJournals = response.filter(journal => journal.hand !== 0).reverse();
                    playedShoe = 0;

                    validJournals.forEach((journal, index) => {
                        const journalDiv = document.createElement('div');
                        journalDiv.classList.add('bg-white', 'border', 'border-gray-300', 'rounded-lg', 'p-2', 'mb-2');

                        // Create a flex container for Shoe, Hand, and Profit
                        const flexContainer = document.createElement('div');
                        flexContainer.classList.add('flex', 'justify-between', 'items-center', 'text-xs', 'text-gray-700');

                        flexContainer.id = `${journal.journalId}`;
                        flexContainer.style.cursor = 'pointer';
                        // Add the click event listener to the div
                        flexContainer.addEventListener('click', function () {

                            getGameArchive(flexContainer.id)
                        });


                        // Create container for left-aligned content (Win/Lose)
                        const leftContainer = document.createElement('div');
                        leftContainer.classList.add('flex-grow', 'text-left');

                        // Create "Win/Lose" label
                        const winLoseLabel = document.createElement('h4');
                        winLoseLabel.classList.add('text-xs', 'ml-2', 'block');
                        winLoseLabel.textContent = 'Win/Lose';

                        // Create "20/20" value on a new line
                        const winLoseValue = document.createElement('span');
                        winLoseValue.classList.add('text-xs', 'ml-2', 'block');
                        winLoseValue.textContent = `${journal.winLose}`;  // Adjust the values as needed

                        // Append Win/Lose label and value
                        leftContainer.appendChild(winLoseLabel);
                        leftContainer.appendChild(winLoseValue);

                        // Create container for center-aligned content (Shoe)
                        const centerContainer = document.createElement('div');
                        centerContainer.classList.add('flex-none', 'text-center');
                        const shoeHeading = document.createElement('h4');
                        shoeHeading.classList.add('font-semibold', 'text-sm');
                        shoeHeading.textContent = `Round: ${journal.shoe}`;
                        centerContainer.appendChild(shoeHeading);

                        // can you aslo put 'statregy' label under the Shoe
                        // Create Strategy label and append it under the Shoe heading
                        const strategyLabel = document.createElement('span');
                        strategyLabel.classList.add('font-normal', 'text-xs');
                        strategyLabel.textContent = `${toCamelCase(journal.strategy.replace("_", " "))}`;
                        centerContainer.appendChild(strategyLabel);


                        // Create container for right-aligned content (Hand, Profit)
                        const rightContainer = document.createElement('div');
                        rightContainer.classList.add('flex-grow', 'text-right');
                        rightContainer.innerHTML = `
                        <p>Rolls: ${journal.hand}</p>
                        <p>Profit: ${journal.profit}</p>
                    `;

                        totalProfit += journal.profit;

                        // Append elements
                        flexContainer.appendChild(leftContainer);
                        flexContainer.appendChild(centerContainer);
                        flexContainer.appendChild(rightContainer);
                        journalDiv.appendChild(flexContainer);
                        $('#journalContainer').append(journalDiv);


                        playedShoe++;
                    });






                    $('#totalProfit').text(totalProfit);


                    getProfitGraph("");

                } catch (xhr) {
                    console.error('Error fetching journals:', xhr);
                    //  alert('An error occurred while fetching journals. Please try again.');
                }
                await fetchGameParameters();
                // await fetchGameParameters();




            }

            async function currentState() {


                try {
                    const statusMessage = $('#status').text();
                    const response = await $.ajax({
                        url: '/api/sicBo/current-state',
                        type: 'GET',
                        data: { message: statusMessage }
                    });
                    displayResultToUi(response);
                    showorHideStrategiesDots();
                } catch (xhr) {
                    console.error('Error fetching current state:', xhr);
                    $('#status').text(`Error: ${xhr.responseText}`);
                }






            }


            async function getGameArchive(journalId) {
                try {
                    const response = await $.ajax({
                        url: '/api/journals/get-archive',
                        type: 'GET',
                        data: { journalId }
                    });

                    // Handle the successful response
                    displayResultToUi(response);

                    // const riskLevelImage = document.getElementById('riskLevelImage');
                    // riskLevelImage.onclick = null; // Disable click event

                    // Update UI with archive information
                    $('#infoHeader').text("Archive");
                    $('#infoContent').text("Note: This is for viewing purposes only and cannot be modified. Please refresh your page to restore the original state.");
                } catch (error) {
                    // Log the error details in case of failure
                    console.error('Error fetching archive:', error);
                    // Optionally, display an error message in the UI
                    $('#infoHeader').text("Error");
                    $('#infoContent').text("Failed to fetch the game archive. Please try again later.");
                }
            }

            function turnOnOffSkip() {
                const button = document.getElementById("skipButton");

                if (button.classList.contains("from-yellow-600")) {

                    setShieldValue('OFF');
                } else {
                    setShieldValue('ON');

                }
            }




            function getHandResult(response) {

                let handResult = response.handResult;
                let skipState = response.skipState;

                const handResultContainer = document.getElementById('handResultContainer');
                handResultContainer.innerHTML = "";

                if (!handResult) {
                    return;
                }


                const fragment = document.createDocumentFragment();


                handResult.replace(/[^WL]/g, '').split('').forEach((result, index) => {
                    const circle = document.createElement('div');
                    const isWin = result === 'W';
                    const isLoss = result === 'L';
                    const isShouldSkip = skipState[index] === 'Y';


                    circle.className = `flex items-center justify-center w-5 h-5 rounded-full text-white text-xs ${isWin ? 'bg-green-500' : isLoss ? 'bg-red-500' : 'bg-yellow-500'
                        }`;

                    // circle.innerText = isWin ? 'W' : isLoss ? 'L' : 'S';
                    // circle.style.color = isShouldSkip ? 'yellow' : 'white'; 
                    // circle.style.fontWeight = isShouldSkip ? 'bold' : 'normal'; 
                    circle.classList.add(isShouldSkip ? 'text-yellow-500' : 'text-white');
                    if (isShouldSkip) {
                        circle.classList.add('font-bold');  // Apply bold text if skipState is true
                    }

                    // Set the inner text
                    circle.innerText = isWin ? 'W' : isLoss ? 'L' : 'S';

                    fragment.appendChild(circle);
                });

                handResultContainer.appendChild(fragment);


                setTimeout(() => {
                    handResultContainer.scrollLeft = handResultContainer.scrollWidth;
                }, 0);
            }


            function updateProgressBar(percentageInput) {
                const percentage = percentageInput * 100; // Convert to percentage
                const progressBar = document.getElementById('progressBar');

                // Set the width of the progress bar
                progressBar.style.width = `${percentage}%`;

                // Change class based on percentage to adjust color
                if (percentage < 30) {
                    progressBar.className = 'progress-bar low';
                } else if (percentage < sensitivityGlobal) {
                    progressBar.className = 'progress-bar medium';
                } else {
                    progressBar.className = 'progress-bar high';
                }
            }


            async function getActiveUsers() {
                try {
                    const response = await $.ajax({
                        url: '/active-users',  // Ensure this endpoint exists in your backend
                        type: 'GET'            // Method type
                    });

                    $('#activeUsersCount').text(response);

                } catch (error) {
                    // Log the error details
                    console.error('Error fetching active users:', error);
                }
            }


            function handleViewChange() {
                const dayRadio = document.getElementById('dayRadio');
                const weekRadio = document.getElementById('weekRadio');

                // Determine the filter based on which radio button is checked
                const filterBy = dayRadio.checked ? 'Day' : weekRadio.checked ? 'Week' : null;

                if (filterBy) {
                    getProfitGraph(filterBy);
                }
            }






            function getProfitGraph() {
                const dayRadio = document.getElementById('dayRadio');
                const filterBy = dayRadio.checked ? 'Day' : 'Week'; // Use a ternary operator for clarity

                fetch(`/api/journals/profit-data?filterBy=${filterBy}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(profitData => {
                        // Destroy the existing chart if it exists
                        if (dummyGraph) {
                            try {
                                dummyGraph.destroy();
                            } catch (error) {
                                console.error('Error destroying chart:', error);
                            }
                        }

                        // Create a new chart instance
                        dummyGraph = new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: profitData.labels,
                                datasets: [{
                                    label: profitData.data[profitData.data.length - 1],
                                    data: profitData.data,
                                    fill: false,
                                    borderColor: 'rgba(75, 192, 192, 1)',
                                    tension: 0.1
                                }]
                            },
                            options: {
                                responsive: true,
                                scales: {
                                    x: {
                                        ticks: {
                                            autoSkip: true, // Automatically skip ticks
                                            maxTicksLimit: 10, // Limit the number of ticks
                                            maxRotation: 45, // Rotate labels if needed
                                            minRotation: 0 // Minimum label rotation
                                        }
                                    },
                                    y: {
                                        beginAtZero: true
                                    }
                                }
                            }
                        });
                    })
                    .catch(error => {
                        console.error('Error fetching profit data:', error);
                    });
            }





            function showTab(tab) {
                // Containers
                const profitAndReportSection = document.getElementById('profitAndReportSection');
                const journalContainer = document.getElementById('journalContainer');
                const graphContainer = document.getElementById('graphContainer');
                const challengeContainer = document.getElementById('challengeContainer');




                // Tabs
                const journalTab = document.getElementById('journalTab');
                const graphTab = document.getElementById('graphTab');
                const challengeTab = document.getElementById('challengeTab');

                // Reset visibility of all containers
                journalContainer.classList.add('hidden');
                graphContainer.classList.add('hidden');
                challengeContainer.classList.add('hidden');
                profitAndReportSection.classList.add('hidden');

                // Reset styles for all tabs
                journalTab.classList.remove('border-blue-500', 'text-gray-700');
                graphTab.classList.remove('border-blue-500', 'text-gray-700');
                challengeTab.classList.remove('border-blue-500', 'text-gray-700');
                journalTab.classList.add('text-gray-500');
                graphTab.classList.add('text-gray-500');
                challengeTab.classList.add('text-gray-500');

                // Show the selected tab and apply active styling
                if (tab === 'History') {
                    journalContainer.classList.remove('hidden');
                    profitAndReportSection.classList.remove('hidden');
                    journalTab.classList.add('border-blue-500', 'text-gray-700');
                } else if (tab === 'graph') {
                    graphContainer.classList.remove('hidden');
                    graphTab.classList.add('border-blue-500', 'text-gray-700');
                } else if (tab === 'challenge') {
                    challengeContainer.classList.remove('hidden');
                    challengeTab.classList.add('border-blue-500', 'text-gray-700');
                }
            }


            async function setShieldValue(yesNoValue) {

                try {
                    const response = await $.ajax({
                        url: '/api/sicBo/freeze-state',
                        type: 'POST',
                        data: { onOff: yesNoValue }
                    });

                    getFreezeStateAsync();

                } catch (error) {
                    console.log('Error:', error);
                    alert('Operation failed: ' + error.responseText);  // Optionally show an error message
                }
            }


            // async function setStrategyValue(strategyValue) {


            //     try {
            //         const response = await $.ajax({
            //             url: '/api/sicBo/strategy',
            //             type: 'POST',
            //             data: { strategy: strategyValue }
            //         });

            //         getStrategy();

            //     } catch (error) {
            //         console.log('Error:', error);
            //         alert('Operation failed: ' + error.responseText);  // Optionally show an error message
            //     }
            // }

            async function getFreezeStateAsync() {

                const button = document.getElementById("skipButton");
                try {
                    const response = await $.ajax({
                        url: '/api/sicBo/get-freeze-state',
                        type: 'GET'
                    });

                    // freezeState =  response;
                    // console.log(response);
                    // console.log(freezeState);



                    if (response === 'OFF') {

                        freezeState = 'N'

                        var recommendedBet = $("#recommendedBet").text();
                        var suggestedBetUnitValue = $("#suggestedBetUnit").text();
                        $('#nextbetText').text(recommendedBet.includes('Wait') ? "0" : suggestedBetUnitValue);

                        button.classList.remove("bg-gradient-to-l", "from-yellow-600", "to-yellow-700");
                        button.classList.add("bg-gradient-to-l", "from-gray-600", "to-gray-700");

                    } else {

                        // Revert back to the original yellow color
                        button.classList.remove("bg-gradient-to-l", "from-gray-600", "to-gray-700");
                        button.classList.add("bg-gradient-to-l", "from-yellow-600", "to-yellow-700");
                        freezeState = 'Y'
                        // $('#nextbetText').text("0");
                    }

                    // console.log(freezeState);

                } catch (error) {
                    console.log('Error:', error);
                    alert('Operation failed: ' + error.responseText);  // Optionally show an error message
                }
            }




            function showorHideStrategiesDots() {
                // const handCountValue = $("#handCount").text();

                var pauseAndPlayValue = localStorage.getItem('pauseAndPlay');

                if (pauseAndPlayValue === 'play') {
                    $('#resetButton').show();
                    $('#threeDotsButton').show();
                } else {
                    $('#threeDotsButton').hide();
                    $('#resetButton').hide();
                }
            }




            // function hideStrategyDialog() {



            //     const menu = document.getElementById('dropdownMenu');
            //     const button = document.getElementById('threeDotsButton');
            //     if (!menu.contains(event.target) && event.target !== button) {
            //         menu.classList.add('hidden');
            //     }

            // }


            function getNumbersFromString(str) {
                return str.replace(/\D/g, '');  // \D matches any non-digit character
            }

            function toCamelCase(str) {
                // Convert to lowercase and capitalize only the first letter
                return str.toLowerCase().replace(/^[a-z]/, (match) => match.toUpperCase());
            }


        </script>

</body>

</html>